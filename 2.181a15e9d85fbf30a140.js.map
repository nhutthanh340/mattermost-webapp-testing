{"version":3,"sources":["webpack:///./components/logged_in/index.js","webpack:///./components/logged_in/logged_in.jsx","webpack:///./node_modules/mattermost-redux/actions/timezone.js"],"names":["mapStateToProps","state","ownProps","license","getLicense","config","getConfig","showTermsOfService","shouldShowTermsOfService","currentUser","getCurrentUser","currentChannelId","getCurrentChannelId","mfaRequired","checkIfMFARequired","match","url","enableTimezone","ExperimentalTimezone","getChannelURLAction","channel","teamId","dispatch","getState","browserHistory","push","getChannelURL","mapDispatchToProps","actions","bindActionCreators","autoUpdateTimezone","connect","LoggedIn","store","BACKSPACE_CHAR","React","PureComponent","constructor","props","origin","data","type","message","window","location","version","desktop","semver","valid","coerce","userIsActive","manual","WebSocketClient","userUpdateActiveStatus","focus","root","document","getElementById","className","isValidState","componentDidMount","WebSocketActions","getBrowserTimezone","$","on","off","cookie","indexOf","viewChannel","addEventListener","onFocusListener","onBlurListener","onDesktopMessageListener","postMessage","UserAgent","addClass","attr","GlobalActions","encodeURIComponent","pathname","mouseOver","ev","prev","next","removeClass","closest","find","e","which","target","is","preventDefault","componentWillUnmount","removeEventListener","render","children","PropTypes","object","string","bool","isRequired","shape","func"],"mappings":"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","file":"2.181a15e9d85fbf30a140.js","sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport {autoUpdateTimezone} from 'mattermost-redux/actions/timezone';\nimport {getCurrentChannelId} from 'mattermost-redux/selectors/entities/channels';\nimport {getLicense, getConfig} from 'mattermost-redux/selectors/entities/general';\nimport {getCurrentUser, shouldShowTermsOfService} from 'mattermost-redux/selectors/entities/users';\n\nimport {browserHistory} from 'utils/browser_history';\nimport {checkIfMFARequired} from 'utils/route';\nimport {getChannelURL} from 'utils/utils';\n\nimport LoggedIn from './logged_in.jsx';\n\nfunction mapStateToProps(state, ownProps) {\n    const license = getLicense(state);\n    const config = getConfig(state);\n    const showTermsOfService = shouldShowTermsOfService(state);\n\n    return {\n        currentUser: getCurrentUser(state),\n        currentChannelId: getCurrentChannelId(state),\n        mfaRequired: checkIfMFARequired(getCurrentUser(state), license, config, ownProps.match.url),\n        enableTimezone: config.ExperimentalTimezone === 'true',\n        showTermsOfService,\n    };\n}\n\n// NOTE: suggestions where to keep this welcomed\nconst getChannelURLAction = (channel, teamId) => (dispatch, getState) => browserHistory.push(getChannelURL(getState(), channel, teamId));\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        actions: bindActionCreators({\n            autoUpdateTimezone,\n            getChannelURLAction,\n        }, dispatch),\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LoggedIn);\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport $ from 'jquery';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport {Redirect} from 'react-router';\nimport {viewChannel} from 'mattermost-redux/actions/channels';\nimport semver from 'semver';\n\nimport * as GlobalActions from 'actions/global_actions.jsx';\nimport * as WebSocketActions from 'actions/websocket_actions.jsx';\nimport * as UserAgent from 'utils/user_agent';\nimport LoadingScreen from 'components/loading_screen';\nimport {getBrowserTimezone} from 'utils/timezone.jsx';\nimport store from 'stores/redux_store.jsx';\nimport WebSocketClient from 'client/web_websocket_client.jsx';\n\nconst dispatch = store.dispatch;\nconst getState = store.getState;\n\nconst BACKSPACE_CHAR = 8;\n\nexport default class LoggedIn extends React.PureComponent {\n    static propTypes = {\n        currentUser: PropTypes.object,\n        currentChannelId: PropTypes.string,\n        children: PropTypes.object,\n        mfaRequired: PropTypes.bool.isRequired,\n        enableTimezone: PropTypes.bool.isRequired,\n        actions: PropTypes.shape({\n            autoUpdateTimezone: PropTypes.func.isRequired,\n            getChannelURLAction: PropTypes.func.isRequired,\n        }).isRequired,\n        showTermsOfService: PropTypes.bool.isRequired,\n    }\n\n    constructor(props) {\n        super(props);\n\n        const root = document.getElementById('root');\n        if (root) {\n            root.className += ' channel-view';\n        }\n    }\n\n    isValidState() {\n        return this.props.currentUser != null;\n    }\n\n    componentDidMount() {\n        // Initialize websocket\n        WebSocketActions.initialize();\n\n        if (this.props.enableTimezone) {\n            this.props.actions.autoUpdateTimezone(getBrowserTimezone());\n        }\n\n        // Make sure the websockets close and reset version\n        $(window).on('beforeunload',\n            () => {\n                // Turn off to prevent getting stuck in a loop\n                $(window).off('beforeunload');\n                if (document.cookie.indexOf('MMUSERID=') > -1) {\n                    viewChannel('', this.props.currentChannelId || '')(dispatch, getState);\n                }\n                WebSocketActions.close();\n            },\n        );\n\n        // Listen for focused tab/window state\n        window.addEventListener('focus', this.onFocusListener);\n        window.addEventListener('blur', this.onBlurListener);\n\n        // Listen for messages from the desktop app\n        window.addEventListener('message', this.onDesktopMessageListener);\n\n        // Tell the desktop app the webapp is ready\n        window.postMessage(\n            {\n                type: 'webapp-ready',\n            },\n            window.location.origin,\n        );\n\n        // Because current CSS requires the root tag to have specific stuff\n\n        // Device tracking setup\n        if (UserAgent.isIos()) {\n            $('body').addClass('ios');\n        } else if (UserAgent.isAndroid()) {\n            $('body').addClass('android');\n        }\n\n        if (!this.props.currentUser) {\n            $('#root').attr('class', '');\n            GlobalActions.emitUserLoggedOutEvent('/login?redirect_to=' + encodeURIComponent(this.props.location.pathname), true, false);\n        }\n\n        $('body').on('mouseenter mouseleave', ':not(.post-list__dynamic) .post', function mouseOver(ev) {\n            if (ev.type === 'mouseenter') {\n                $(this).prev('.date-separator, .new-separator').addClass('hovered--after');\n                $(this).next('.date-separator, .new-separator').addClass('hovered--before');\n            } else {\n                $(this).prev('.date-separator, .new-separator').removeClass('hovered--after');\n                $(this).next('.date-separator, .new-separator').removeClass('hovered--before');\n            }\n        });\n\n        $('body').on('mouseenter mouseleave', '.search-item__container .post', function mouseOver(ev) {\n            if (ev.type === 'mouseenter') {\n                $(this).closest('.search-item__container').find('.date-separator').addClass('hovered--after');\n                $(this).closest('.search-item__container').next('div').find('.date-separator').addClass('hovered--before');\n            } else {\n                $(this).closest('.search-item__container').find('.date-separator').removeClass('hovered--after');\n                $(this).closest('.search-item__container').next('div').find('.date-separator').removeClass('hovered--before');\n            }\n        });\n\n        $('body').on('mouseenter mouseleave', ':not(.post-list__dynamic) .post.post--comment.same--root', function mouseOver(ev) {\n            if (ev.type === 'mouseenter') {\n                $(this).prev('.date-separator, .new-separator').addClass('hovered--comment');\n                $(this).next('.date-separator, .new-separator').addClass('hovered--comment');\n            } else {\n                $(this).prev('.date-separator, .new-separator').removeClass('hovered--comment');\n                $(this).next('.date-separator, .new-separator').removeClass('hovered--comment');\n            }\n        });\n\n        // Prevent backspace from navigating back a page\n        $(window).on('keydown.preventBackspace', (e) => {\n            if (e.which === BACKSPACE_CHAR && !$(e.target).is('input, textarea')) {\n                e.preventDefault();\n            }\n        });\n    }\n\n    componentWillUnmount() {\n        WebSocketActions.close();\n\n        $('body').off('click.userpopover');\n        $('body').off('mouseenter mouseleave', '.post');\n        $('body').off('mouseenter mouseleave', '.post.post--comment.same--root');\n\n        $('.modal').off('show.bs.modal');\n\n        $(window).off('keydown.preventBackspace');\n\n        window.removeEventListener('focus', this.onFocusListener);\n        window.removeEventListener('blur', this.onBlurListener);\n        window.removeEventListener('message', this.onDesktopMessageListener);\n    }\n\n    render() {\n        if (!this.isValidState()) {\n            return <LoadingScreen/>;\n        }\n\n        if (this.props.mfaRequired) {\n            if (this.props.location.pathname !== '/mfa/setup') {\n                return <Redirect to={'/mfa/setup'}/>;\n            }\n        } else if (this.props.location.pathname === '/mfa/confirm') {\n            // Nothing to do. Wait for MFA flow to complete before prompting TOS.\n        } else if (this.props.showTermsOfService) {\n            if (this.props.location.pathname !== '/terms_of_service') {\n                return <Redirect to={'/terms_of_service?redirect_to=' + encodeURIComponent(this.props.location.pathname)}/>;\n            }\n        }\n\n        return this.props.children;\n    }\n\n    onFocusListener() {\n        GlobalActions.emitBrowserFocus(true);\n    }\n\n    onBlurListener() {\n        GlobalActions.emitBrowserFocus(false);\n    }\n\n    // listen for messages from the desktop app\n    onDesktopMessageListener = ({origin, data: {type, message = {}} = {}} = {}) => {\n        if (!this.props.currentUser) {\n            return;\n        }\n        if (origin !== window.location.origin) {\n            return;\n        }\n\n        switch (type) {\n        case 'register-desktop': {\n            const {version} = message;\n            if (!window.desktop) {\n                window.desktop = {};\n            }\n            window.desktop.version = semver.valid(semver.coerce(version));\n            break;\n        }\n        case 'user-activity-update': {\n            const {userIsActive, manual} = message;\n\n            // update the server with the users current away status\n            if (userIsActive === true || userIsActive === false) {\n                WebSocketClient.userUpdateActiveStatus(userIsActive, manual);\n            }\n            break;\n        }\n        case 'notification-clicked': {\n            const {channel, teamId} = message;\n            window.focus();\n\n            // navigate to the appropriate channel\n            this.props.actions.getChannelURLAction(channel, teamId);\n            break;\n        }\n        }\n    }\n}\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\n// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\nvar users_1 = require(\"../selectors/entities/users\");\r\nvar timezone_1 = require(\"../selectors/entities/timezone\");\r\nvar users_2 = require(\"./users\");\r\nfunction autoUpdateTimezone(deviceTimezone) {\r\n    var _this = this;\r\n    return function (dispatch, getState) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\r\n        var currentUer, currentTimezone, newTimezoneExists, timezone, updatedUser;\r\n        return tslib_1.__generator(this, function (_a) {\r\n            currentUer = users_1.getCurrentUser(getState());\r\n            currentTimezone = timezone_1.getUserTimezone(getState(), currentUer.id);\r\n            newTimezoneExists = currentTimezone.automaticTimezone !== deviceTimezone;\r\n            if (currentTimezone.useAutomaticTimezone && newTimezoneExists) {\r\n                timezone = {\r\n                    useAutomaticTimezone: 'true',\r\n                    automaticTimezone: deviceTimezone,\r\n                    manualTimezone: currentTimezone.manualTimezone,\r\n                };\r\n                updatedUser = tslib_1.__assign(tslib_1.__assign({}, currentUer), { timezone: timezone });\r\n                users_2.updateMe(updatedUser)(dispatch, getState);\r\n            }\r\n            return [2 /*return*/];\r\n        });\r\n    }); };\r\n}\r\nexports.autoUpdateTimezone = autoUpdateTimezone;\r\n//# sourceMappingURL=timezone.js.map"],"sourceRoot":""}