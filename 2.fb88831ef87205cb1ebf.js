(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1353:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(4),r=o(9),s=o(185),a=o(17);t.autoUpdateTimezone=function(e){var t=this;return function(o,i){return n.__awaiter(t,void 0,void 0,(function(){var t,c,d,p,u;return n.__generator(this,(function(m){return t=r.getCurrentUser(i()),c=s.getUserTimezone(i(),t.id),d=c.automaticTimezone!==e,c.useAutomaticTimezone&&d&&(p={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:c.manualTimezone},u=n.__assign(n.__assign({},t),{timezone:p}),a.updateMe(u)(o,i)),[2]}))}))}}},1513:function(e,t,o){"use strict";o.r(t);o(119);var n=o(315),r=o(11),s=o(1353),a=o(12),i=o(16),c=o(9),d=o(87),p=o(1415),u=o(15),m=o(100),l=o.n(m),h=o(33),f=o.n(h),v=o(6),w=o.n(v),b=o(1112),g=o(38),C=o(345),_=o.n(C),y=o(1126),U=o(1223),T=o(18),k=o(1125),L=o(188),O=o(20),z=o(1359);function j(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const R=O.a.dispatch,E=O.a.getState;class x extends w.a.PureComponent{constructor(e){super(e),j(this,"onDesktopMessageListener",({origin:e,data:{type:t,message:o={}}={}}={})=>{if(this.props.currentUser&&e===window.location.origin)switch(t){case"register-desktop":{const{version:e}=o;window.desktop||(window.desktop={}),window.desktop.version=_.a.valid(_.a.coerce(e));break}case"user-activity-update":{const{userIsActive:e,manual:t}=o;!0!==e&&!1!==e||z.a.userUpdateActiveStatus(e,t);break}case"notification-clicked":{const{channel:e,teamId:t}=o;window.focus(),this.props.actions.getChannelURLAction(e,t);break}}});const t=document.getElementById("root");t&&(t.className+=" channel-view")}isValidState(){return null!=this.props.currentUser}componentDidMount(){U.b(),this.props.enableTimezone&&this.props.actions.autoUpdateTimezone(Object(L.a)()),l()(window).on("beforeunload",()=>{l()(window).off("beforeunload"),document.cookie.indexOf("MMUSERID=")>-1&&Object(g.viewChannel)("",this.props.currentChannelId||"")(R,E),U.a()}),window.addEventListener("focus",this.onFocusListener),window.addEventListener("blur",this.onBlurListener),window.addEventListener("message",this.onDesktopMessageListener),window.postMessage({type:"webapp-ready"},window.location.origin),T.h()?l()("body").addClass("ios"):T.a()&&l()("body").addClass("android"),this.props.currentUser||(l()("#root").attr("class",""),y.e("/login?redirect_to="+encodeURIComponent(this.props.location.pathname),!0,!1)),l()("body").on("mouseenter mouseleave",":not(.post-list__dynamic) .post",(function(e){"mouseenter"===e.type?(l()(this).prev(".date-separator, .new-separator").addClass("hovered--after"),l()(this).next(".date-separator, .new-separator").addClass("hovered--before")):(l()(this).prev(".date-separator, .new-separator").removeClass("hovered--after"),l()(this).next(".date-separator, .new-separator").removeClass("hovered--before"))})),l()("body").on("mouseenter mouseleave",".search-item__container .post",(function(e){"mouseenter"===e.type?(l()(this).closest(".search-item__container").find(".date-separator").addClass("hovered--after"),l()(this).closest(".search-item__container").next("div").find(".date-separator").addClass("hovered--before")):(l()(this).closest(".search-item__container").find(".date-separator").removeClass("hovered--after"),l()(this).closest(".search-item__container").next("div").find(".date-separator").removeClass("hovered--before"))})),l()("body").on("mouseenter mouseleave",":not(.post-list__dynamic) .post.post--comment.same--root",(function(e){"mouseenter"===e.type?(l()(this).prev(".date-separator, .new-separator").addClass("hovered--comment"),l()(this).next(".date-separator, .new-separator").addClass("hovered--comment")):(l()(this).prev(".date-separator, .new-separator").removeClass("hovered--comment"),l()(this).next(".date-separator, .new-separator").removeClass("hovered--comment"))})),l()(window).on("keydown.preventBackspace",e=>{8!==e.which||l()(e.target).is("input, textarea")||e.preventDefault()})}componentWillUnmount(){U.a(),l()("body").off("click.userpopover"),l()("body").off("mouseenter mouseleave",".post"),l()("body").off("mouseenter mouseleave",".post.post--comment.same--root"),l()(".modal").off("show.bs.modal"),l()(window).off("keydown.preventBackspace"),window.removeEventListener("focus",this.onFocusListener),window.removeEventListener("blur",this.onBlurListener),window.removeEventListener("message",this.onDesktopMessageListener)}render(){if(!this.isValidState())return w.a.createElement(k.a,null);if(this.props.mfaRequired){if("/mfa/setup"!==this.props.location.pathname)return w.a.createElement(b.a,{to:"/mfa/setup"})}else if("/mfa/confirm"===this.props.location.pathname);else if(this.props.showTermsOfService&&"/terms_of_service"!==this.props.location.pathname)return w.a.createElement(b.a,{to:"/terms_of_service?redirect_to="+encodeURIComponent(this.props.location.pathname)});return this.props.children}onFocusListener(){y.a(!0)}onBlurListener(){y.a(!1)}}j(x,"propTypes",{currentUser:f.a.object,currentChannelId:f.a.string,children:f.a.object,mfaRequired:f.a.bool.isRequired,enableTimezone:f.a.bool.isRequired,actions:f.a.shape({autoUpdateTimezone:f.a.func.isRequired,getChannelURLAction:f.a.func.isRequired}).isRequired,showTermsOfService:f.a.bool.isRequired});const I=(e,t)=>(o,n)=>d.a.push(Object(u.r)(n(),e,t));t.default=Object(n.connect)((function(e,t){const o=Object(i.getLicense)(e),n=Object(i.getConfig)(e),r=Object(c.shouldShowTermsOfService)(e);return{currentUser:Object(c.getCurrentUser)(e),currentChannelId:Object(a.getCurrentChannelId)(e),mfaRequired:Object(p.a)(Object(c.getCurrentUser)(e),o,n,t.match.url),enableTimezone:"true"===n.ExperimentalTimezone,showTermsOfService:r}}),(function(e){return{actions:Object(r.bindActionCreators)({autoUpdateTimezone:s.autoUpdateTimezone,getChannelURLAction:I},e)}}))(x)}}]);
//# sourceMappingURL=2.fb88831ef87205cb1ebf.js.map